package docker

import (
	"dockerydo/internal/types"
	"fmt"
	"os/exec"
	"strings"

	tea "github.com/charmbracelet/bubbletea"
)

func StartStopContainer(c types.Container) tea.Cmd {
	return func() tea.Msg {
		var dockerCmd string
		if c.State == "running" {
			dockerCmd = "stop"
		} else if c.State == "exited" {
			dockerCmd = "start"
		} else {
			return types.ErrMsg(fmt.Errorf("container %s is in an unknown state: %s", c.Names, c.State))
		}

		cmd := exec.Command("docker", dockerCmd, c.ID)
		out, err := cmd.Output()
		if err != nil {
			return types.ErrMsg(err)
		}
		if strings.TrimSpace(string(out)) != c.ID {
			return types.ErrMsg(fmt.Errorf("unexpected output from docker %s %s: %s", dockerCmd, c.ID, out))
		}

		return types.StartStopMsg{ContainerID: c.ID, Success: true}
	}
}
